%li{ class: mr_css_classes(merge_request) }
  .merge-request-title
    %span.merge-request-title-text
      = link_to_gfm merge_request.title, merge_request_path(merge_request), class: "row_title"
    .merge-request-labels
      - merge_request.labels.each do |label|
        = link_to_label(label, project: merge_request.project)
    .pull-right.light
      - if merge_request.merged?
        %span
          %i.fa.fa-check
          MERGED
      - elsif merge_request.closed?
        %span
          %i.fa.fa-ban
          CLOSED
      - note_count = merge_request.mr_and_commit_notes.user.count
      - if merge_request.assignee
        &nbsp;
        = link_to_member(merge_request.source_project, merge_request.assignee, name: false)
      - if note_count > 0
        &nbsp;
        %span
          %i.fa.fa-comments
          = note_count
      - else
        &nbsp;
        %span.merge-request-no-comments
          %i.fa.fa-comments
          = 0

  .merge-request-info
    = "##{merge_request.iid} opened #{time_ago_with_tooltip(merge_request.created_at, placement: 'bottom')} by #{link_to_member(@project, merge_request.author, avatar: false)}".html_safe
    
    - if merge_request.upvotes > 0
      %span.vote.upvote.label.label-success.avatar-voters
        %i.fa.fa-thumbs-up
        \+
        = merge_request.upvotes

        - merge_request.upvoters.each do |participant|
          = link_to_member(@project, participant, name: false, size: 16)
      
    - if merge_request.downvotes > 0
      %span.vote.downvote.label.label-danger.avatar-voters
        %i.fa.fa-thumbs-down
        \-
        = merge_request.downvotes

        - merge_request.downvoters.each do |participant|
          = link_to_member(@project, participant, name: false, size: 16)
    
    - if merge_request.open?
      / Declarando as variáveis
      - resultado_testes = merge_request.resultado_testes if not @project.nil?
      - commit = merge_request.ultimo_commit if not @project.nil?

      - if not commit.nil? and not resultado_testes.nil?
        - if resultado_testes.ultimo_commit[0..7] == commit.short_id && resultado_testes.resultado == 1
          %span.label.label-success.has_tooltip{'data-title' => "#{time_ago_in_words(resultado_testes.data_execucao)}" }
            %i.fa.fa-thumbs-up 
            Testes
        - elsif resultado_testes.ultimo_commit[0..7] == commit.short_id && resultado_testes.resultado == 2
          %span.label.label-danger.has_tooltip{'data-title' => "#{time_ago_in_words(resultado_testes.data_execucao)}" }
            %i.fa.fa-thumbs-down
            Testes
        - elsif resultado_testes.ultimo_commit[0..7] == commit.short_id && resultado_testes.resultado == 3
          %span.label.label-danger.has_tooltip{'data-title' => "#{time_ago_in_words(resultado_testes.data_execucao)}" }
            %i.fa.fa-chain-broken
            Em Conflito
        - elsif resultado_testes.ultimo_commit[0..7] == commit.short_id && resultado_testes.resultado == 4
          %span.label.label-warning
            %i.fa.fa-refresh.fa-spin
            Testes em Execução
        - else
          %span.label.label-inverse
            %i.fa.fa-thumbs-down
            Testes Pendentes
      - else
        %span.label.label-inverse
          %i.fa.fa-thumbs-down
          Testes Pendentes

    - if merge_request.milestone_id?
      &nbsp;
      %span
        %i.fa.fa-clock-o
        = merge_request.milestone.title
    - if merge_request.tasks?
      %span.task-status
        = merge_request.task_status

    .pull-right.hidden-xs
      %span updated #{time_ago_with_tooltip(merge_request.updated_at, placement: 'bottom', html_class: 'merge_request_updated_ago')}
